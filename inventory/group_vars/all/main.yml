# Main options

# Summary
project_version: v0.8b

# Users with sudo
admins:
  - name: mak
    color: "01;33m"
    comment: "Mikhail Kucherenko"
    email: "makucherenko@list.ru"
    key: "https://github.com/snipghost.keys"
  - name: horifox
    color: "01;32m"
    comment: "Tagir Khanmurzin"
    email: "lhorifoxl@gmail.com"
    git_name: HoriFox
    key: "https://github.com/horifox.keys"
# Non-privileged users
users:
  - name: rgbaybarin
    color: "01;36m"
    comment: "Roman Baybarin"
    email: "rbaybarin@gmail.com"
    git_name: RBizonDota
    key: "https://github.com/RBizonDota.keys"
    servers_group: dev

# locale.gen
locales:
  - { code: "en_US.UTF-8" }
  - { code: "ru_RU.UTF-8" }

# Path to SSD-disks for all disk-based services
data_path: "/mnt/data"

# Chronyd options
ntpd_servers:
  - ntp1.mail.ru
  - ntp2.mail.ru

# Local DNS via dnsmasq. DEPRECATED!
# dnsmasq_records_file: /etc/cluster-hosts
# dnsmasq_exporter_enabled: no
# dnsmasq_logging: no
# dnsmasq_iface: eth0:{{ service_vip_id }}
# DNS records in dns.yml

# PowerDNS
pdns_api_domain: dnsapi.argobay.ml
pdns_dns_port: 5300
pdns_api_port: 8181
pdns_recursor_port: 53
pdns_recursor_api_port: 8182
pdns_admin_port: 8787
pdns_dns_local_addrs:
  - 127.0.0.1
pdns_api_local_addr: "{{ ansible_default_ipv4['address'] }}"
pdns_recursor_api_local_addr: "{{ ansible_default_ipv4['address'] }}"
pdns_recursor_local_addrs:
  - 127.0.0.1
  - "{{ ansible_default_ipv4['address'] }}"
  - "{{ service_vip_ip }}"
pdns_allowed_hosts:
  - 127.0.0.1/32
  - 192.168.8.0/24
  - 192.168.9.0/24
  - "{{ docker_pdns_admin_subnet }}"
pdns_forward_zones:
  - name: i
    host: 127.0.0.1:{{ pdns_dns_port }}
  - name: e
    host: 127.0.0.1:{{ pdns_dns_port }}
  - name: w
    host: 127.0.0.1:{{ pdns_dns_port }}
  - name: local
    host: 127.0.0.1:{{ pdns_dns_port }}
  - name: dev-argobay.ml
    host: 127.0.0.1:{{ pdns_dns_port }}
  - name: argobay.ml
    host: 127.0.0.1:{{ pdns_dns_port }}
  - name: 168.192.in-addr.arpa
    host: 127.0.0.1:{{ pdns_dns_port }}
  - name: "{{ consul_domain }}"
    host: "{{ consul_listen_addr | first }}:{{ consul_dns_port }}"

# Backup scripts
backup_scripts:
  - tpl: backup-db
    interval: daily
    group: prod_db_servers
    retention: 3
    important_databases:
      - dacrover
      - krionardtech
      - mysql
      - powerdns
  - tpl: backup-grafana
    interval: daily
    group: monitoring_servers
    retention: 3

# rsyncd
rsync_users:
  - name: "{{ rsync_certs_user }}"
    password: "{{ rsync_certs_pass }}"
# sections in config
rsync_modules:
  - name: certs_live
    uid: root
    gid: root
    path: /etc/letsencrypt/live/
    comment: SSL certs links
    ro: yes
    list: yes
    users:
      - "{{ rsync_certs_user }}"
    has_secrets: yes
    group: all
  - name: certs_archive
    uid: root
    gid: root
    path: /etc/letsencrypt/archive/
    comment: SSL certs files
    ro: yes
    list: yes
    users:
      - "{{ rsync_certs_user }}"
    has_secrets: yes
    group: all

# LetsAPI
letsapi_cron_freq: weekly
letsapi_path: /etc/letsapi
cert_path: "{{ letsapi_path }}/live"
letsapi_cert_renewers:
  - host: nino
    cert: argobay.ml
  - host: rikka
    cert: dev-argobay.ml

# Consul
consul_log_level: INFO
consul_version: 1.10.1
consul_domain: consul
consul_dc: main
consul_acl: no
consul_recursors:
  - "{{ service_vip_ip }}"
consul_enable_local_script_checks: true
consul_raft_multiplier: 5
consul_dns_port: 8600
consul_http_port: 8500
consul_listen_addr:
  - 127.0.0.1

# Jupyter
jupyter_port: 8888

# Docker
docker_datapath: "{{ data_path }}/docker"
docker_runner_bridge: br_runner
docker_pdns_admin_bridge: br_pdns_admin
docker_default_subnet: 172.17.0.0/16
docker_runner_subnet: 172.100.0.0/16
docker_pdns_admin_subnet: 172.101.0.0/16
docker_bridges:
  - name: docker0
    cidr: "{{ docker_default_subnet }}"
    group: all
  - name: "{{ docker_runner_bridge }}"
    cidr: "{{ docker_runner_subnet }}"
    group: gitlab_runner
  - name: "{{ docker_pdns_admin_bridge }}"
    cidr: "{{ docker_pdns_admin_subnet }}"
    group: dns_servers
    accept_rules:
      - proto: tcp
        port: 3307
      - proto: tcp
        port: "{{ pdns_api_port }}"
      - proto: tcp
        port: 80
      - proto: tcp
        port: 443

# GitLab Runner
gitlab_runner_name: arm-runner
gitlab_runner_install_dir: "{{ data_path }}/runners/{{ gitlab_runner_name }}"
gitlab_runner_reg_url: https://bmstu.codes/
