[global]
fsid = {{ ceph_fsid }}
mon host = {% for host in server_names -%}
  {{ lookup('dig', host) }}{% if not loop.last %},{% endif %}
{%- endfor %}{{ '' }}
public network = {{ ansible_default_ipv4['address'].split('.')[:3]|join('.') }}.0/24

ms dispatch throttle bytes = 1073741824

objecter inflight ops = 8192
objecter inflight op bytes = 1073741824

osd crush chooseleaf type = 1
osd crush update on start = false

osd scrub sleep = 0.1
osd scrub chunk min = 1
osd scrub chunk max = 2

osd scrub min interval = 604800
osd scrub max interval = 5184000
osd deep scrub interval = 5184000
osd scrub during recovery = true

[mon]
mon initial members = {{ ceph_init_member }}
mon allow pool delete = true

osd pool default flag nodelete = true
osd pool default min size = 1
osd pool default size = 2
osd pool default pg num = {{ ceph_pg_count }}
osd pool default pgp num = {{ ceph_pg_count }}

[osd]
bdev aio reap max = 128

osd journal size = {{ ceph_journal_size }}
osd memory target = {{ ceph_cache_size }}
bluestore cache size = {{ ceph_cache_size }}

bluestore rocksdb options = compression=kNoCompression,max_write_buffer_number=32,min_write_buffer_number_to_merge=2,recycle_log_file_num=32,compaction_style=kCompactionStyleLevel,write_buffer_size=67108864,target_file_size_base=67108864,max_background_compactions=31,level0_file_num_compaction_trigger=8,level0_slowdown_writes_trigger=32,level0_stop_writes_trigger=64,max_bytes_for_level_base=536870912,compaction_threads=32,max_bytes_for_level_multiplier=8,flusher_threads=8,compaction_readahead_size=2MB

bluestore cache autotune = 0
bluestore cache kv ratio = 0.2
bluestore cache meta ratio = 0.8

osd scrub begin hour = 1
osd scrub end hour = 9

[client]
rbd cache = true
